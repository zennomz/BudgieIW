CREATE DATABASE IF NOT EXISTS budgieiw;
USE budgieiw;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    firstname VARCHAR(50) NOT NULL,
    lastname VARCHAR(50) NOT NULL,
    date_of_birth DATE NOT NULL,
    numero_phone VARCHAR(20),
    email VARCHAR(60) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role ENUM('user', 'admin') NOT NULL DEFAULT 'user',
    token VARCHAR(64),
    verification_token VARCHAR(64),
    is_active BOOLEAN NOT NULL DEFAULT FALSE,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NULL DEFAULT NULL
);

CREATE TABLE accounts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    balance DECIMAL(14, 2) NOT NULL DEFAULT 0.00,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NULL DEFAULT NULL,
    rate_remuneration DECIMAL(5, 2) NOT NULL DEFAULT 0.00,
    rate_imposition DECIMAL(5, 2) NOT NULL DEFAULT 0.00,
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE previsions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    date_prevision DATE NOT NULL,
    total_income DECIMAL(14, 2) NOT NULL DEFAULT 0.00,
    total_expense DECIMAL(14, 2) NOT NULL DEFAULT 0.00,
    total_interest DECIMAL(14, 2) NOT NULL DEFAULT 0.00,
    total_final DECIMAL(14, 2) NOT NULL DEFAULT 0.00,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NULL DEFAULT NULL,
    account_id INT NOT NULL,
    FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE
);

CREATE TABLE incomes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    recurring BOOLEAN NOT NULL DEFAULT 0,
    value_recurring ENUM('MONTHLY','WEEKLY','YEARLY') NULL,
    amount DECIMAL(14, 2) NOT NULL,
    date_start DATE NOT NULL,
    date_end DATE,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NULL DEFAULT NULL,
    account_id INT NOT NULL,
    FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE
);

CREATE TABLE expenses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    recurring BOOLEAN NOT NULL DEFAULT 0,
    value_recurring ENUM('MONTHLY','WEEKLY','YEARLY') NULL,
    amount DECIMAL(14, 2) NOT NULL,
    date_start DATE NOT NULL,
    date_end DATE,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NULL DEFAULT NULL,
    account_id INT NOT NULL,
    FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE
);